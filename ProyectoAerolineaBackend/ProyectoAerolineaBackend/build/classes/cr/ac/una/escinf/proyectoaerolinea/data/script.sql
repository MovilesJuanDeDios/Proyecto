/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
/**
 * Author:  slon
 * Created: 12/05/2018
 */
connect system/manager as sysdba;
 
-- ----------------- USUARIO ----------------- 
create user servidor identified by servidor;

grant all privileges to servidor identified by servidor;

connect servidor/servidor;

-- ----------------- CREACION DE UN CURSOR -----------------
CREATE OR REPLACE PACKAGE TYPES
AS
     TYPE REF_CURSOR IS REF CURSOR;
END;
/

-- ----------------- TABLA DE USUARIOS -----------------
CREATE TABLE USUARIOS(
        NOMBRE VARCHAR(15),
	APELLIDOS VARCHAR(30),
	CORREO VARCHAR(30),
	FECHA_NAC VARCHAR(30),
	DIRECCION VARCHAR(90),
        CELULAR VARCHAR(15),
        TELEFONO VARCHAR(15),
        USUARIO VARCHAR(16),
        CONTRASENA VARCHAR(16),
	CONSTRAINTS PK_USUARIO PRIMARY KEY (USUARIO)
);

-- ----------------- INSERTAR USUARIO ----------------- 
CREATE OR REPLACE PROCEDURE INSERTAR_USUARIO(
NOMBRE IN USUARIOS.NOMBRE%TYPE, 
APELLIDOS IN USUARIOS.APELLIDOS%TYPE, 
CORREO IN USUARIOS.CORREO%TYPE, 
FECHA_NAC IN USUARIOS.FECHA_NAC%TYPE, 
DIRECCION IN USUARIOS.DIRECCION%TYPE,
CELULAR IN USUARIOS.CELULAR%TYPE,
TELEFONO IN USUARIOS.TELEFONO%TYPE,
USUARIO IN USUARIOS.USUARIO%TYPE,
CONTRASENA IN USUARIOS.CONTRASENA%TYPE)
AS
BEGIN
    INSERT INTO USUARIOS VALUES(NOMBRE, APELLIDOS, CORREO, FECHA_NAC, DIRECCION, 
CELULAR, TELEFONO, USUARIO, CONTRASENA);
END;
/

-- ----------------- ACTUALIZAR USUARIO ----------------- 
CREATE OR REPLACE PROCEDURE ACTUALIZAR_USUARIO(
NOMBREIN IN USUARIOS.NOMBRE%TYPE, 
APELLIDOSIN IN USUARIOS.APELLIDOS%TYPE, 
CORREOIN IN USUARIOS.CORREO%TYPE, 
FECHA_NACIN IN USUARIOS.FECHA_NAC%TYPE, 
DIRECCIONIN IN USUARIOS.DIRECCION%TYPE,
CELULARIN IN USUARIOS.CELULAR%TYPE,
TELEFONOIN IN USUARIOS.TELEFONO%TYPE,
USUARIOIN IN USUARIOS.USUARIO%TYPE, 
CONTRASENAIN IN USUARIOS.CONTRASENA%TYPE)
AS
BEGIN
    UPDATE USUARIOS SET NOMBRE=NOMBREIN, APELLIDOS=APELLIDOSIN,
CORREO=CORREOIN, FECHA_NAC=FECHA_NACIN, DIRECCION=DIRECCIONIN, 
CELULAR=CELULARIN, TELEFONO=TELEFONOIN, CONTRASENA=CONTRASENAIN  
WHERE USUARIO=USUARIOIN;
END;
/

-- ----------------- BUSCAR USUARIO ----------------- 
CREATE OR REPLACE FUNCTION BUSCAR_USUARIO(USUARIOIN IN USUARIOS.USUARIO%TYPE)
RETURN TYPES.REF_CURSOR 
AS 
        USUARIO_CURSOR TYPES.REF_CURSOR; 
BEGIN 
  OPEN USUARIO_CURSOR FOR 
       SELECT * FROM USUARIOS WHERE USUARIO=USUARIOIN; 
RETURN USUARIO_CURSOR; 
END;
/

-- -----------------  DROPS -----------------
DROP PROCEDURE INSERTAR_USUARIO;
DROP PROCEDURE ACTUALIZAR_USUARIO;
DROP FUNCTION BUSCAR_USUARIO;
DROP TABLE USUARIOS;